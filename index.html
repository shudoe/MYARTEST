<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>多角色 AR.js 自動生成系統</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false;"
      loading-screen="enabled: false;"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
      embedded
      gesture-detector
    >
      <!-- 動態生成 assets 與 marker -->
      <a-assets id="model-assets"></a-assets>

      <script>
        // ✅ 這裡設定角色清單，新增角色只要加在這裡！
        const characters = [
          { name: "白", scale: "2 2 2" },
          { name: "黑", scale: "2 2 2" },
          { name: "紅", scale: "2 2 2" },
	  { name: "藍", scale: "2 2 2" },
          { name: "綠", scale: "2 2 2" },
	  { name: "灰", scale: "2 2 2" },
	  { name: "紫", scale: "2 2 2" },
          { name: "黃", scale: "2 2 2" },
	  { name: "橘", scale: "2 2 2" },
	  { name: "棕", scale: "2 2 2" },
          // 你可以繼續加，例如：
          // { name: "藍", scale: "2 2 2" },
          // { name: "綠", scale: "2 2 2" },
        ];

        const scene = document.querySelector("a-scene");
        const assets = document.getElementById("model-assets");

        characters.forEach((ch) => {
          // 建立模型資源
          const assetItem = document.createElement("a-asset-item");
          assetItem.setAttribute("id", `${ch.name}-model`);
          assetItem.setAttribute("src", `assets/${ch.name}機器人.glb`);
          assets.appendChild(assetItem);

          // 建立 marker
          const marker = document.createElement("a-marker");
          marker.setAttribute("id", `marker-${ch.name}`);
          marker.setAttribute("type", "pattern");
          marker.setAttribute("url", `assets/pattern-${ch.name}色機器人.patt`);
          marker.setAttribute("raycaster", "objects: .clickable");
          marker.setAttribute("emitevents", "true");
          marker.setAttribute("cursor", "fuse: false; rayOrigin: mouse;");

          // 建立模型實體
          const entity = document.createElement("a-entity");
          entity.setAttribute("gltf-model", `#${ch.name}-model`);
          entity.setAttribute("scale", ch.scale);
          entity.setAttribute("animation-mixer", "loop: repeat");
          entity.setAttribute("class", "clickable");
          entity.setAttribute("gesture-handler", "");

          marker.appendChild(entity);
          scene.appendChild(marker);
        });
      </script>

      <!-- 相機 -->
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
